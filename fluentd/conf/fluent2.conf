<system>
  log_level info
  workers 1
</system>

# ============================================================
# 1. 兩個數據來源 (Sources)
# ============================================================

<source>
  @type forward
  bind 0.0.0.0
  port 24224
  @label @APP
</source>

<source>
  @type http
  bind 0.0.0.0
  port 9880
  @label @SYSTEM
</source>

# ============================================================
# 2. 載入微服務配置（按服務拆分）
# ============================================================
@include conf.d/*-2.conf

# ============================================================
# 3. 系統指標處理（全局配置）
# ============================================================

# --- 標籤 [2]: @SYSTEM (系統指標處理) ---
<label @SYSTEM>
  <filter **>
    @type record_transformer
    <record>
      hostname "#{Socket.gethostname}"
      service_name "system-monitor"
    </record>
  </filter>

  <match **>
    @type opensearch
    host opensearch
    port 9200
    scheme http
    logstash_format true
    logstash_prefix system-metrics
    logstash_dateformat %Y.%m.%d
    <buffer>
      @type memory
      flush_interval 5s
    </buffer>
  </match>
</label>
