<system>
  log_level info
  workers 4
</system>

# ============================================================
# 1. 數據來源 (Sources)
# ============================================================

# 接收來自 fluent-bit-sidecar 的 forward 協議日誌
<source>
  @type forward
  bind 0.0.0.0
  port 24224
  # 所有來自 fluent-bit 的日誌先進入 @FLUENT_BIT label 進行路由
  @label @FLUENT_BIT
</source>

# ============================================================
# 2. 載入微服務配置（按服務拆分）
# ============================================================
@include conf.d/*-3.conf

# ============================================================
# 3. Fluent-bit 日誌路由處理
# ============================================================

# --- 標籤 [1]: @FLUENT_BIT (Fluent-bit 日誌路由) ---
<label @FLUENT_BIT>
  # 路由 Order App 日誌到 @ORDER_APP label
  <match order.log>
    @type relabel
    @label @ORDER_APP
  </match>

  # 路由 User App 日誌到 @USER_APP label
  <match user.log>
    @type relabel
    @label @USER_APP
  </match>

  # 其他日誌（不匹配的）可以記錄或丟棄
  <match **>
    @type null
  </match>
</label>
